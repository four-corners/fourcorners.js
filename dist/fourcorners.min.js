!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("FourCorners",[],e):"object"==typeof exports?exports.FourCorners=e():t.FourCorners=e()}(window,function(){return c={},i.m=n=[function(t,e,n){t.exports=n(1)},function(t,e,n){function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],c=!0,i=!1,s=void 0;try{for(var a,r=t[Symbol.iterator]();!(c=(a=r.next()).done)&&(n.push(a.value),!e||n.length!==e);c=!0);}catch(t){i=!0,s=t}finally{try{c||null==r.return||r.return()}finally{if(i)throw s}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(t,e){for(var n=0;n<e.length;n++){var c=e[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n(2);var r=function(){function c(t,e){a(this,c),this.cornerSlugs=["authorship","backstory","imagery","links"],this.elems={embed:t};var n=m(this);this.strings={},this.setUpData(n),this.onImgLoad=new Event("onImgLoad"),this.onImgFail=new Event("onImgFail"),this.initModule()}var t,e,n;return t=c,(e=[{key:"setUpData",value:function(t){this.lang=t&&t.lang?t.lang:"en",this.strings=k[this.lang],this.photo=o(this,t),this.opts=Object.assign(L,this.opts),this.opts=t?Object.assign(this.opts,t.opts):{},this.content={authorship:t?t.authorship:{},backstory:t?t.backstory:{},imagery:t?t.imagery:{},links:t?t.links:{}},this.elems.photo=this.addPhoto(),this.elems.panels=this.addPanels(),this.elems.corners=this.addCorners(),this.elems.media=this.embedMedia(),this.elems.cutline=this.addCutline();var c=this;return Object.keys(this.elems.corners).forEach(function(t,e){var n=c.elems.corners[t];c.opts.static||n.classList.contains("fc-interactive")||(n.addEventListener("mouseenter",c.hoverCorner.bind(c)),n.addEventListener("mouseleave",c.unhoverCorner.bind(c)),n.addEventListener("click",c.clickCorner.bind(c)),n.classList.add("fc-interactive"))}),this}},{key:"initModule",value:function(){var i=this,t=this.elems.embed;t.classList.add("fc-init"),this.opts.dark&&t.classList.add("fc-dark"),this.opts.static?t.classList.add("fc-static"):t.addEventListener("click",function(t){var e=g(t.target,i.getPanel()),n=g(t.target,i.elems.corners),c=g(t.target,Array.from(document.querySelectorAll("#creator")));e||n||c||(i.closePanel(),i.elems.embed.classList.remove("fc-full"))}),t.lang=this.lang,["ar"].includes(this.lang)?t.dir="rtl":t.dir="ltr",window.addEventListener("resize",this.resizeModule.bind(this)),this.resizeModule()}},{key:"updateModule",value:function(t){if(!t)m(this);return this.setUpData(t),this.initModule(),this}},{key:"getPanel",value:function(t){var e=this.elems.embed;if(e){var n=".fc-panel";return t?(n+='[data-fc-slug="'+t+'"]',e.querySelector(n)):e.querySelectorAll(n)}}},{key:"openPanel",value:function(n){var c=this,t=c.cornerSlugs,e=c.elems.embed,i=c.elems.corners[n],s=c.getPanel(n);e.classList.remove("fc-full"),e&&i&&s&&(e.dataset.fcActive=n,e.classList.add("fc-active"),i.classList.add("fc-active"),s.classList.add("fc-active")),t.forEach(function(t,e){t!=n&&c.closePanel(t)})}},{key:"closePanel",value:function(t){var e=this.elems.embed;if(t=t||e.dataset.fcActive){var n=this.elems.corners[t],c=this.getPanel(t);t==e.dataset.fcActive&&(e.dataset.fcActive="",e.classList.remove("fc-active")),n&&n.classList.remove("fc-active"),c&&c.classList.remove("fc-active")}}},{key:"toggleExpandPanel",value:function(){this.elems.embed.classList.toggle("fc-full")}},{key:"hoverCorner",value:function(t){t.target.classList.add("fc-hover")}},{key:"unhoverCorner",value:function(t){t.target.classList.remove("fc-hover")}},{key:"clickCorner",value:function(t){var e=t.target.dataset.fcSlug,n=this.elems.embed.dataset.fcActive;e&&(e==n?this.closePanel(e):this.openPanel(e))}},{key:"addCorners",value:function(){var a,r=this,o={},l=this.elems.embed,d=(this.elems.photo,this.opts.active),u=k[this.lang];return this.cornerSlugs.forEach(function(t,e){var n='.fc-corner[data-fc-slug="'+t+'"]',c=u?u[t]:null,i=l.querySelector(n),s=!!i;(i=i||document.createElement("div")).dataset.fcSlug=t,i.title=c?"View "+c:null,i.classList.add("fc-corner"),i.classList.add("fc-"+t),t==d&&i.classList.add("fc-active"),r.content&&((a=r.content[t])&&Object.keys(a).length||i.classList.add("fc-empty")),o[t]=i,s||l.appendChild(i)}),o}},{key:"addPanels",value:function(){var l=this,c={};if(this.elems.embed)return this.cornerSlugs.forEach(function(t,e){var n=l.opts.active,c=l.getPanel(t);c&&c.remove();var i="";if(l.content&&l.content[t]){var s=l.content[t];switch(t){case"authorship":i=d(l,s);break;case"backstory":i=u(l,s);break;case"imagery":i=f(l,s);break;case"links":i=v(l,s)}}var a=l.strings[t],r="fc-panel fc-"+t;t==n&&(r+=" fc-active");var o='<div data-fc-slug="'.concat(t,'" class="').concat(r,'">\n\t\t\t\t\t<div class="fc-panel-title">\n\t\t\t\t\t\t<span>').concat(a,'</span>\n\t\t\t\t\t\t<div class="fc-icon fc-expand" title="Expand this panel"></div>\n\t\t\t\t\t\t<div class="fc-icon fc-close" title="Close this panel"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="fc-panel-title fc-pseudo">\n\t\t\t\t\t\t<span>').concat(l.cornerSlugs.indexOf(t),"</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t").concat(i?'<div class="fc-scroll">\n\t\t\t\t\t\t<div class="fc-inner">\n\t\t\t\t\t\t\t'.concat(i,"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>"):"","\n\t\t\t\t</div>");l.elems.embed.innerHTML+=o}),this.cornerSlugs.forEach(function(e,t){var n=l.getPanel(e);(c[e]=n).querySelector(".fc-expand").addEventListener("click",function(t){l.toggleExpandPanel()}),n.querySelector(".fc-close").addEventListener("click",function(t){l.closePanel(e),l.elems.embed.classList.remove("fc-full")})}),c}},{key:"addPhoto",value:function(){var t,e=this,n=this.elems.embed,c=(this.photo?this.photo.width:null)/(this.photo?this.photo.height:null);n.style.paddingBottom=100/c+"%",(t=n.querySelector(".fc-img"))||n.classList.add("fc-empty");var i=new Image;return n.classList.add("fc-loading"),i.onload=function(t){n.style.paddingBottom="",n.classList.remove("fc-loading"),n.dispatchEvent(e.onImgLoad)},i.onerror=function(t){n.classList.remove("fc-loading"),n.classList.add("fc-empty"),n.dispatchEvent(e.onImgFail)},i.src=t?t.src:null,t}},{key:"addCutline",value:function(){var t=this.content.authorship;if((t||this.opts.caption||this.opts.credit||this.opts.logo)&&this.content.authorship){var e=this.elems.embed,n=this.opts.caption&&t.caption?'<span class="fc-caption">'.concat(t.caption,"</span>"):"",c=this.opts.credit&&(t.credit||t.license.holder)?'<div class="fc-credit">\n\t\t\t\t'.concat((t.credit?"<span>".concat(t.credit,"</span>"):"")+(t.license.holder?"<span>".concat(t.license.holder,"</span>"):""),"\n\t\t\t</div>"):"",i=this.opts.logo?'<a href="https://fourcornersproject.org" target="_blank" class="fc-logo" title="This is a Four Corners photo"></a>':"",s='<div class="fc-cutline">\n\t\t\t\t'.concat(n+c+i,"\n\t\t\t</div>");return e.insertAdjacentHTML("afterend",s),s}}},{key:"embedMedia",value:function(){var c=this,t=this.content.imagery;if(t){var i=t.media;if(i)Object.keys(i).forEach(function(t,e){var n=i[t];("image"!=n.source&&n.source?p:h)(c,n,"imagery",e)})}}},{key:"resizeModule",value:function(){var n=this.getPanel();n&&Object.keys(n).forEach(function(t,e){l(n[t])})}}])&&i(t.prototype,e),n&&i(t,n),c}(),o=function(t,e){if(e&&e.photo&&e.photo.src)return e.photo;var n=t.elems.embed?t.elems.embed.querySelector("img"):null;return{src:n?n.src:null}},l=function(t){if("function"==typeof t.querySelector){var e=t.querySelector(".fc-scroll");e&&(e.scrollHeight>e.clientHeight?t.classList.add("fc-overflow"):t.classList.remove("fc-overflow"))}},d=function(t,e){var n,c="";c+=e.caption?'<div class="fc-field">\n\t\t\t<em>'.concat(e.caption,"</em>\n\t\t</div>"):"";var i=[];e.license||(e.license={});var s="copyright"==e.license.type;return e.license.year&&i.push("<span>".concat(e.license.year,"</span>")),e.credit&&i.push("<span>".concat(e.license.holder?e.credit+"/"+e.license.holder:e.credit,"</span>")),c+=s||e.credit?'<div class="fc-field" data-fc-field="credit">\n\t\t\t\t<div class="fc-content">\n\t\t\t\t\t'.concat(s?'<div class="fc-copyright">\n\t\t\t\t\t\t\t'.concat(i.join(""),"\n\t\t\t\t\t\t</div>"):"<div>".concat(e.credit,"</div>"),"\n\t\t\t\t</div>\n\t\t\t</div>"):"",c+=e.license&&e.license.label&&"commons"==e.license.type?'<div class="fc-field" data-fc-field="license">\n\t\t\t\t<span class="fc-label">'.concat(t.strings.license,'</span>\n\t\t\t\t<span class="fc-content">\n\t\t\t\t\t').concat(e.license.url?'<a href="'.concat(e.license.url,'" target="_blank">\n\t\t\t\t\t\t').concat(e.license.label?e.license.label:"","\n\t\t\t\t\t</a>"):e.license.label?e.license.label:"","\n\t\t\t\t</span>\n\t\t\t</div>"):"",c+=e.ethics&&e.ethics.desc?'<div class="fc-field" data-fc-field="ethics">\n\t\t\t\t<span class="fc-label">'.concat(t.strings.cod,'</span>\n\t\t\t\t<span class="fc-content">').concat(e.ethics.desc,"</span>\n\t\t\t</div>"):"",c+=e.bio?'<div class="fc-field">\n\t\t\t<span class="fc-label">'.concat(t.strings.bio,"</span>\n\t\t\t").concat(e.bio,"\n\t\t</div>"):"",(c+=e.website||e["0-contact"]||e["1-contact"]?'<div class="fc-field fc-contact">\n\n\t\t\t'.concat(e.website?'<div class="fc-field fc-card">\n\t\t\t\t<div class="fc-label">'.concat(t.strings.website,"</div>\n\t\t\t\t").concat(b(e.website),"\n\t\t\t</div>"):"","\n\n\t\t\t").concat(e["0-contact"]?'<div class="fc-field fc-card">\n\t\t\t\t<div class="fc-label">'.concat(t.strings.info,"</div>\n\t\t\t\t").concat(b(e["0-contact"]),"\n\t\t\t</div>"):"","\n\n\t\t\t").concat(e["1-contact"]?'<div class="fc-field fc-card">\n\t\t\t\t<div class="fc-label">'.concat(t.strings.rights,"</div>\n\t\t\t\t").concat(b(e["1-contact"]),"\n\t\t\t</div>"):"","\n\n\t\t</div>"):"").length&&(n='<div class="fc-row">'.concat(c,"</div>")),n},u=function(n,t){return"".concat(t.text?'<div class="fc-row">\n\t\t\t'.concat(c(t.text),"\n\t\t</div>"):"","\n\t\t").concat(t.media?t.media.map(function(t,e){return p(n,t,"backstory",e),'<div class="fc-row">\n\t\t\t\t<div class="fc-media" data-fc-source="'.concat(t.source,'"></div>\n\t\t\t\t').concat(t.caption?'<div class="fc-sub-caption">'.concat(t.caption,"</div>"):"","\n\t\t\t\t").concat(t.credit?'<div class="fc-sub-credit">'.concat(t.credit,"</div>"):"","\n\t\t\t</div>")}).join(""):"")},f=function(t,e){if(e.media)return"".concat(e.media.map(function(t,e){var n=["instagram","youtube","vimeo"].includes(t.source);return'<div class="fc-row">\n\t\t\t\t<div class="fc-media" data-fc-source="'.concat(t.source,'">\n\t\t\t\t</div>\n\t\t\t\t').concat(t.caption?'<div class="fc-sub-caption">'.concat(t.caption,"</div>"):"","\n\t\t\t\t").concat(t.credit||n?'<div class="fc-sub-credit">\n\t\t\t\t\t\t'.concat(n&&t.url?'<a href="'.concat(t.url,'" target="_blank">'):"","\n\t\t\t\t\t\t\t").concat(t.credit||"View on "+y(t.url),"\n\t\t\t\t\t\t").concat(n?"</a>":"","\n\t\t\t\t\t</div>"):"","\n\t\t\t</div>")}).join(""))},v=function(t,e){if(e.links)return e.links.map(function(t){if(!t||!t.url)return null;var e=y(t.url),n=t.url?"".concat(t.title?t.title:e,'\n\t\t\t<div class="fc-sub-url">').concat(e,"</div>"):"";return'<div class="fc-row">'.concat(b(t.url,n,["fc-card"]),"</div>")}).join("")},h=function(n,c,i,s){if(c.url){var t=new Image;t.onload=function(t){var e='<img src="'.concat(c.url,'"/>');n.elems.panels[i].querySelectorAll(".fc-media")[s].innerHTML+=e},t.src=c.url}},p=function(i,s,a,r){var t="";switch(s.source){case"youtube":t="https://noembed.com/embed?url="+s.url;break;case"vimeo":t="https://vimeo.com/api/oembed.json?url="+s.url;break;case"soundcloud":t="https://soundcloud.com/oembed?format=json&url="+s.url;break;case"instagram":t="https://api.instagram.com/oembed/?url="+s.url;break;default:return!1}var e=new Headers;fetch(t,{method:"GET",headers:e}).then(function(t){if(!t.ok)throw Error(t.statusText);return t.json()}).then(function(t){var e=i.elems.panels[a].querySelectorAll(".fc-media")[r],n="";if(n="instagram"==s.source?'<img src="'.concat(t.thumbnail_url,'"/>'):t.html,Number.isInteger(t.width,t.height)){var c=t.height/t.width;e.classList.add("fc-responsive"),e.style.paddingBottom=100*c+"%"}e.innerHTML=n}).catch(function(t){console.warn("Four Corners cannot load this media source: "+s.url,t)})},m=function(t){if(t.elems&&t.elems.embed){var e=t.elems.embed.dataset.fc;if(e)return delete t.elems.embed.dataset.fc,JSON.parse(e)}},g=function(c,t){var i=!1;return Object.entries(t).forEach(function(t){var e=s(t,2),n=(e[0],e[1]);n&&n.contains&&n.contains(c)&&(i=!0)}),i},c=function(t){var e=t.split(/\n/g);return e?"".concat(e.map(function(t,e){return t?"<p>".concat(t,"</p>"):"<br/>"}).join("")):""},b=function(t,e,n){var c=2<arguments.length&&void 0!==n?n:[];return e=e||y(t),-1<t.indexOf("@")&&(t="mailto:"+t),'<a href="'.concat(t,'" target="_blank" class="').concat(c.join(" "),'">').concat(e,"</a>")},y=function(t){if(!t)return null;var e,n=(e=t)?(-1<e.indexOf("//")?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0]:null,c=n.split("."),i=c.length;return 2<i&&(n=c[i-2]+"."+c[i-1],2==c[i-2].length&&2==c[i-1].length&&(n=c[i-3]+"."+n)),n},k={en:{authorship:"Authorship",backstory:"Backstory",imagery:"Related Imagery",links:"Links",license:"License",cod:"Code of ethics",bio:"Bio",website:"Website",info:"For more info",rights:"للحصول على حقوق النسخ"},ar:{authorship:"التأليف",backstory:"القصة وراء الصورة ",imagery:"الصور ذات الصلة",links:"الروابط",license:"الترخيص",cod:"ميثاق أخلاقيات",bio:"السيرة الذاتية",website:"الموقع الكتروني",info:"لمزيد من المعلومات",rights:"للحصول على حقوق النسخ"}},L={selector:".fc-embed",static:!1,caption:!1,credit:!1,logo:!1,active:""};t.exports=function t(){var c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a(this,t);var e=[];if(c.elem instanceof Element)e=[c.elem];else if(NodeList.prototype.isPrototypeOf(c.elem))e=Array.from(c.elem);else{var n="string"==typeof c.selector?c.selector:".fc-embed";e=Array.from(document.querySelectorAll(n))}var i=[];return e.forEach(function(t,e){var n=new r(t,c);i.push(n)}),i}},function(t,e,n){}],i.c=c,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)i.d(n,c,function(t){return e[t]}.bind(null,c));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0);function i(t){if(c[t])return c[t].exports;var e=c[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var n,c});